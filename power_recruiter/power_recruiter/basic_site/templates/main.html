{% extends "base_generic.html" %}
{% load staticfiles %}
{% block content %}
{% for state in states %}
    <div class="stateCheckboxDiv"><input type="checkbox" class="stateCheckbox" name="{{ state }}" checked /> {{ state }}</div>
{% endfor %}
<script>
    $('.stateCheckbox').change(function() {
        url = {% url 'json' %};
        $('.stateCheckbox').each(function(){
            if($(this).is(":checked")){
                url += "&" + encodeURIComponent(this.name) + "=true";
            }
        });
        $("#maintable").attr("data-url", url);
        reloadData();
    });
</script>
<table id="maintable" data-toggle="table" data-url="{% url 'json' %}" data-cache="false" data-sort-name="price" data-sort-order="desc">
    <thead>
        <tr>
            <th data-field="id" data-sortable="true">ID</th>
            <th data-field="candidate_name" data-sortable="true">Name</th>
            <th data-field="source" data-sortable="true">Source</th>
            <th data-field="state" data-sortable="true">State</th>
            <th data-field="attachments" data-formatter="attachmentsListFormatter">Attachments</th>
            <th data-field="caveats" data-formatter="caveatsFormatter">Caveats</th>
        </tr>
    </thead>
</table>
<script type="text/javascript" src="{% static "js/maintable.js" %}"></script>

<link href="{% static 'dropzone/css/dropzone.css' %}" type="text/css" rel="stylesheet"/>
<script src="{% static 'dropzone/dropzone.js' %}"></script>
<script>
function attachmentsListFormatter(value) {
    toReturn = '<div class="innertd"><form id="my-awesome-dropzone" class="dropzone" action="{% url "upload" %}" method="post" enctype="multipart/form-data">drop file here to upload';
    toReturn += "{% csrf_token %}";
    toReturn += '<input type="hidden" class="personid" name="person" value="'+ $() +'"></form>';
    i = 0;
    value.forEach(function(){
        toReturn += '<a href="candidate/attachment/get/' + value[i].pk + '">' + value[i].display_name + '</a><br>';
        i++;
    });
    toReturn += "</div>";
    return toReturn;
}

function caveatsFormatter(value) {
    toReturn = '<div class="innertd"><textarea class="caveatsArea">' + value + '</textarea></div>';
    return toReturn;
}
Dropzone.options.myAwesomeDropzone = {
  init: function() {
    this.on("addedfile", function(file) { window.setTimeout(reloadData, 1000); });
  }
};
</script>


{% endblock %}